<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å˜èªã‚³ãƒ³ã‚¯ãƒ¼ãƒ«å¯¾ç­–ã‚¢ãƒ—ãƒª</title>
  <style>
    /* ï¼ï¼ï¼ å…¨ä½“ã®è±ªè¯ãªã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      /* ãƒ¢ãƒ€ãƒ³ãªã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
      background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆã‚¬ãƒ©ã‚¹é¢¨ã®å°‘ã—é€ã‘ãŸãƒªãƒƒãƒãªãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
    .container {
      background: rgba(255, 255, 255, 0.95);
      width: 90%;
      max-width: 550px;
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
      text-align: center;
      /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 1.8rem;
      color: #2c3e50;
      margin-bottom: 25px;
      letter-spacing: 1px;
    }
    
    h2 {
      color: #34495e;
    }

    .hidden {
      display: none !important;
    }
    
    /* ï¼ï¼ï¼ ãƒœã‚¿ãƒ³ã®è±ªè¯ãªã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    button {
      border: none;
      padding: 15px 20px;
      margin: 10px 0;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    /* å„ãƒœã‚¿ãƒ³ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ©ãƒ¼ */
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .btn-secondary { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: #2c3e50; }
    .btn-warning { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #2c3e50; }
    .btn-danger { background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%); }
    
    button:disabled {
      background: #e0e0e0;
      color: #999;
      box-shadow: none;
      cursor: not-allowed;
    }

    /* ï¼ï¼ï¼ ãƒ—ãƒ¬ã‚¤ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    #ja-text {
      font-size: 2rem;
      font-weight: bold;
      margin: 25px 0;
      color: #2c3e50;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }
    
    input[type="text"] {
      width: 100%;
      padding: 18px;
      font-size: 1.4rem;
      border: 2px solid #e0e6ed;
      border-radius: 12px;
      box-sizing: border-box;
      margin-bottom: 20px;
      outline: none;
      transition: all 0.3s;
      text-align: center;
      background-color: #f8fafc;
    }
    
    input[type="text"]:focus {
      border-color: #667eea;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
    }
    
    #feedback {
      font-size: 1.3rem;
      font-weight: bold;
      min-height: 35px;
      margin-bottom: 20px;
    }
    .correct { color: #27ae60; animation: pop 0.3s ease; }
    .incorrect { color: #e74c3c; animation: shake 0.4s ease; }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    #progress {
      font-size: 1rem;
      color: #7f8c8d;
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* ï¼ï¼ï¼ å˜èªä¸€è¦§ãƒ»çµæœç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    .scroll-box {
      background: #fdfdfd;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #e0e6ed;
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
      text-align: left;
      font-size: 1rem;
    }

    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå˜èªä¸€è¦§ç”¨ï¼‰ */
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #f4f7f6;
      color: #2c3e50;
      position: sticky;
      top: 0;
    }
    td:first-child { font-weight: bold; color: #7f8c8d; width: 10%; }
    td:nth-child(2) { font-weight: bold; color: #667eea; width: 45%; }
  </style>
</head>
<body>

  <div class="container" id="app-container">
    <h1>âœ¨ å˜èªã‚³ãƒ³ã‚¯ãƒ¼ãƒ«å¯¾ç­– âœ¨</h1>

    <div id="menu-screen">
      <p style="color: #7f8c8d; font-weight: bold;">åéŒ²å˜èªæ•°: <span id="total-word-count" style="color:#2c3e50; font-size:1.2rem;">0</span> èª</p>
      
      <button id="start-all-btn" class="btn-primary">â–¶ å…¨å˜èªã§ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="start-mistake-btn" class="btn-warning" disabled>ğŸ”¥ é–“é•ã„ãƒªã‚¹ãƒˆã§ã‚¹ã‚¿ãƒ¼ãƒˆ (<span id="mistake-count">0</span>)</button>
      <button id="view-list-btn" class="btn-secondary">ğŸ“– å…¨å˜èªä¸€è¦§ã‚’è¦‹ã‚‹</button>
      <button id="clear-mistake-btn" class="btn-danger hidden">ğŸ—‘ é–“é•ã„ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div id="word-list-screen" class="hidden">
      <h2>å…¨å˜èªä¸€è¦§</h2>
      <div class="scroll-box">
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>è‹±èª</th>
              <th>æ—¥æœ¬èª</th>
            </tr>
          </thead>
          <tbody id="word-list-tbody">
            </tbody>
        </table>
      </div>
      <button class="btn-secondary back-to-menu-btn">æˆ»ã‚‹</button>
    </div>

    <div id="play-screen" class="hidden">
      <div id="progress">å•é¡Œ 1 / 10</div>
      <div id="ja-text">æ—¥æœ¬èª</div>
      <input type="text" id="en-input" placeholder="è‹±èªã‚’å…¥åŠ› (Enterã§åˆ¤å®š)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      <div id="feedback"></div>
      <button id="next-btn" class="btn-primary hidden">æ¬¡ã¸</button>
      <button class="btn-secondary back-to-menu-btn" style="margin-top: 30px; font-size: 0.9rem; padding: 10px;">ä¸­æ–­ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>

    <div id="result-screen" class="hidden">
      <h2>ğŸ‰ ãƒ†ã‚¹ãƒˆçµ‚äº†ï¼</h2>
      <p style="font-size: 1.2rem; font-weight: bold;">æ­£è§£æ•°: <span id="score" style="color: #27ae60; font-size: 1.5rem;">0</span> / <span id="total-questions">0</span></p>
      
      <div id="mistake-log-container" class="hidden">
        <p style="color: #e74c3c; font-weight: bold;">ä»Šå›é–“é•ãˆãŸå˜èª:</p>
        <div id="mistake-log" class="scroll-box"></div>
      </div>
      <button class="btn-primary back-to-menu-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>
  </div>

  <script src="words.js"></script>

  <script>
    // å¤‰æ•°è¨­å®š
    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let currentMistakes = []; 
    let savedMistakes = JSON.parse(localStorage.getItem("mistakeWords")) || []; 

    // DOMè¦ç´ ã®å–å¾—
    const menuScreen = document.getElementById('menu-screen');
    const playScreen = document.getElementById('play-screen');
    const resultScreen = document.getElementById('result-screen');
    const wordListScreen = document.getElementById('word-list-screen');
    
    const startAllBtn = document.getElementById('start-all-btn');
    const startMistakeBtn = document.getElementById('start-mistake-btn');
    const clearMistakeBtn = document.getElementById('clear-mistake-btn');
    const viewListBtn = document.getElementById('view-list-btn');
    const nextBtn = document.getElementById('next-btn');
    
    const enInput = document.getElementById('en-input');
    const jaText = document.getElementById('ja-text');
    const progressText = document.getElementById('progress');
    const feedbackText = document.getElementById('feedback');
    const mistakeCountSpan = document.getElementById('mistake-count');
    
    // æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆè¤‡æ•°ã‚ã‚‹ã®ã§ã¾ã¨ã‚ã¦å–å¾—ï¼‰
    const backButtons = document.querySelectorAll('.back-to-menu-btn');

    // åˆæœŸåŒ–å‡¦ç†
    function initMenu() {
      if (typeof allWords !== 'undefined') {
        document.getElementById('total-word-count').innerText = allWords.length;
      } else {
        document.getElementById('total-word-count').innerText = "ã‚¨ãƒ©ãƒ¼: words.jsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
      }
      
      updateMistakeUI();
      
      // ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ãƒˆãƒªã‚¬ãƒ¼ç”¨
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.5s ease-out', 10);

      menuScreen.classList.remove('hidden');
      playScreen.classList.add('hidden');
      resultScreen.classList.add('hidden');
      wordListScreen.classList.add('hidden');
    }

    function updateMistakeUI() {
      mistakeCountSpan.innerText = savedMistakes.length;
      if (savedMistakes.length > 0) {
        startMistakeBtn.disabled = false;
        clearMistakeBtn.classList.remove('hidden');
      } else {
        startMistakeBtn.disabled = true;
        clearMistakeBtn.classList.add('hidden');
      }
    }

    // å˜èªä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½
    function showWordList() {
      const tbody = document.getElementById('word-list-tbody');
      tbody.innerHTML = ''; // ä¸€æ—¦ã‚¯ãƒªã‚¢
      
      if (typeof allWords !== 'undefined') {
        allWords.forEach((word, index) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${word.en}</td>
            <td>${word.ja}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      menuScreen.classList.add('hidden');
      wordListScreen.classList.remove('hidden');
    }

    // ã‚²ãƒ¼ãƒ ã®é€²è¡Œ
    function startGame(mode) {
      if (mode === 'all') {
        currentQuestions = [...allWords];
      } else if (mode === 'mistake') {
        currentQuestions = [...savedMistakes];
      }
      
      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      currentQuestions.sort(() => Math.random() - 0.5);

      currentIndex = 0;
      score = 0;
      currentMistakes = [];
      
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.4s ease-out', 10);

      menuScreen.classList.add('hidden');
      playScreen.classList.remove('hidden');
      
      showQuestion();
    }

    function showQuestion() {
      feedbackText.innerText = "";
      feedbackText.className = ""; // ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
      enInput.value = "";
      enInput.disabled = false;
      nextBtn.classList.add('hidden');
      
      progressText.innerText = `å•é¡Œ ${currentIndex + 1} / ${currentQuestions.length}`;
      jaText.innerText = currentQuestions[currentIndex].ja;
      
      setTimeout(() => enInput.focus(), 50); // å°‘ã—é…ã‚‰ã›ã¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆã‚¹ãƒãƒ›å¯¾ç­–ï¼‰
    }

    // åˆ¤å®šå‡¦ç†
    function checkAnswer() {
      const userAnswer = enInput.value.trim().toLowerCase();
      const correctAnswer = currentQuestions[currentIndex].en.toLowerCase();
      
      enInput.disabled = true;
      
      if (userAnswer === correctAnswer) {
        feedbackText.innerHTML = "â­• æ­£è§£ï¼";
        feedbackText.className = "correct";
        score++;
        
        savedMistakes = savedMistakes.filter(w => w.en !== currentQuestions[currentIndex].en);
        localStorage.setItem("mistakeWords", JSON.stringify(savedMistakes));
        
        setTimeout(nextQuestion, 600);
      } else {
        feedbackText.innerHTML = `âŒ é•ã†ã‚ˆï¼<br>æ­£è§£ã¯ï¼š <strong style="font-size:1.5rem;">${currentQuestions[currentIndex].en}</strong>`;
        feedbackText.className = "incorrect";
        
        const isAlreadyMistaken = savedMistakes.some(w => w.en === currentQuestions[currentIndex].en);
        if (!isAlreadyMistaken) {
          savedMistakes.push(currentQuestions[currentIndex]);
          localStorage.setItem("mistakeWords", JSON.stringify(savedMistakes));
        }
        currentMistakes.push(currentQuestions[currentIndex]);
        
        nextBtn.classList.remove('hidden');
        nextBtn.focus();
      }
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex < currentQuestions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.5s ease-out', 10);

      playScreen.classList.add('hidden');
      resultScreen.classList.remove('hidden');
      
      document.getElementById('score').innerText = score;
      document.getElementById('total-questions').innerText = currentQuestions.length;
      
      const mistakeLogContainer = document.getElementById('mistake-log-container');
      const mistakeLog = document.getElementById('mistake-log');
      
      if (currentMistakes.length > 0) {
        mistakeLogContainer.classList.remove('hidden');
        mistakeLog.innerHTML = currentMistakes.map(w => `${w.ja} <br>â†’ <strong style="color:#667eea;">${w.en}</strong>`).join('<hr style="border:0; border-bottom:1px solid #eee; margin:8px 0;">');
      } else {
        mistakeLogContainer.classList.add('hidden');
      }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    startAllBtn.addEventListener('click', () => startGame('all'));
    startMistakeBtn.addEventListener('click', () => startGame('mistake'));
    viewListBtn.addEventListener('click', showWordList);
    nextBtn.addEventListener('click', nextQuestion);
    
    // å…¨ã¦ã®ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
    backButtons.forEach(btn => {
      btn.addEventListener('click', initMenu);
    });
    
    clearMistakeBtn.addEventListener('click', () => {
      if(confirm('é–“é•ã„ãƒªã‚¹ãƒˆã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã„ã„ï¼Ÿ')) {
        savedMistakes = [];
        localStorage.removeItem("mistakeWords");
        updateMistakeUI();
      }
    });

    enInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        if(enInput.value.trim() !== "") {
          checkAnswer();
        }
      }
    });

    // åˆæœŸåŒ–å®Ÿè¡Œ
    window.onload = () => {
      initMenu();
    };
  </script>
</body>
</html>