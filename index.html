<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å˜èªã‚³ãƒ³ã‚¯ãƒ¼ãƒ«å¯¾ç­–ã‚¢ãƒ—ãƒª</title>
  <style>
    /* ï¼ï¼ï¼ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background: linear-gradient(135deg, #141e30 0%, #243b55 100%);
      color: #e0e0e0;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: rgba(30, 35, 45, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.1);
      width: 90%;
      max-width: 550px;
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.5);
      text-align: center;
      /* Safariç”¨ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ï¼ˆèµ¤ã„ã‚¨ãƒ©ãƒ¼è§£æ¶ˆï¼‰ */
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 1.8rem;
      color: #00f2fe;
      margin-bottom: 25px;
      letter-spacing: 1px;
      text-shadow: 0 0 10px rgba(0, 242, 254, 0.3);
    }
    
    h2 {
      color: #4facfe;
    }

    .hidden {
      display: none !important;
    }
    
    /* ï¼ï¼ï¼ ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    button {
      border: none;
      padding: 15px 20px;
      margin: 10px 0;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    
    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    .btn-primary { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: #000; }
    .btn-secondary { background: linear-gradient(135deg, #434343 0%, #000000 100%); border: 1px solid #555; }
    .btn-warning { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #000; }
    .btn-danger { background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%); }
    .btn-interrupt { margin-top: 30px; font-size: 0.9rem; padding: 10px; }
    
    button:disabled {
      background: #333;
      color: #777;
      box-shadow: none;
      cursor: not-allowed;
      border: 1px solid #444;
    }

    /* ï¼ï¼ï¼ ãƒ—ãƒ¬ã‚¤ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ï¼ï¼ï¼ */
    #ja-text {
      font-size: 2rem;
      font-weight: bold;
      margin: 25px 0;
      color: #ffffff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    input[type="text"] {
      width: 100%;
      padding: 18px;
      font-size: 1.4rem;
      border: 2px solid #555;
      border-radius: 12px;
      box-sizing: border-box;
      margin-bottom: 20px;
      outline: none;
      transition: all 0.3s;
      text-align: center;
      background-color: #1a1f2b;
      color: #00f2fe;
    }
    
    input[type="text"]:focus {
      border-color: #00f2fe;
      background-color: #242c3d;
      box-shadow: 0 0 15px rgba(0, 242, 254, 0.4);
    }
    
    #feedback {
      font-size: 1.3rem;
      font-weight: bold;
      min-height: 35px;
      margin-bottom: 20px;
    }
    .correct { color: #00e676; animation: pop 0.3s ease; text-shadow: 0 0 8px rgba(0,230,118,0.5); }
    .incorrect { color: #ff5252; animation: shake 0.4s ease; text-shadow: 0 0 8px rgba(255,82,82,0.5); }
    .correct-word { font-size: 1.5rem; color: #00f2fe; }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    #progress {
      font-size: 1rem;
      color: #9ba4b5;
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* ï¼ï¼ï¼ å˜èªä¸€è¦§ãƒ»çµæœç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã“ã“ã«ç§»å‹•ï¼‰ ï¼ï¼ï¼ */
    .menu-stats-text { color: #9ba4b5; font-weight: bold; }
    #total-word-count { color: #ffffff; font-size: 1.2rem; }
    .result-score-text { font-size: 1.2rem; font-weight: bold; }
    #score { color: #00e676; font-size: 1.5rem; }
    .mistake-log-title { color: #ff5252; font-weight: bold; }
    .mistake-word { color: #00f2fe; }
    .mistake-separator { border: 0; border-bottom: 1px solid #333; margin: 8px 0; }

    .scroll-box {
      background: #1a1f2b;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #333;
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
      text-align: left;
      font-size: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #333;
    }
    th {
      background-color: #242c3d;
      color: #4facfe;
      position: sticky;
      top: 0;
    }
    td:first-child { font-weight: bold; color: #777; width: 10%; }
    td:nth-child(2) { font-weight: bold; color: #00f2fe; width: 45%; }
  </style>
</head>
<body>

  <div class="container" id="app-container">
    <h1>âœ¨ å˜èªã‚³ãƒ³ã‚¯ãƒ¼ãƒ«å¯¾ç­– âœ¨</h1>

    <div id="menu-screen">
      <p class="menu-stats-text">åéŒ²å˜èªæ•°: <span id="total-word-count">0</span> èª</p>
      
      <button id="start-all-btn" class="btn-primary">â–¶ å…¨å˜èªã§ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="start-mistake-btn" class="btn-warning" disabled>ğŸ”¥ é–“é•ã„ãƒªã‚¹ãƒˆã§ã‚¹ã‚¿ãƒ¼ãƒˆ (<span id="mistake-count">0</span>)</button>
      <button id="view-list-btn" class="btn-secondary">ğŸ“– å…¨å˜èªä¸€è¦§ã‚’è¦‹ã‚‹</button>
      <button id="clear-mistake-btn" class="btn-danger hidden">ğŸ—‘ é–“é•ã„ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div id="word-list-screen" class="hidden">
      <h2>å…¨å˜èªä¸€è¦§</h2>
      <div class="scroll-box">
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>è‹±èª</th>
              <th>æ—¥æœ¬èª</th>
            </tr>
          </thead>
          <tbody id="word-list-tbody">
            </tbody>
        </table>
      </div>
      <button class="btn-secondary back-to-menu-btn">æˆ»ã‚‹</button>
    </div>

    <div id="play-screen" class="hidden">
      <div id="progress">å•é¡Œ 1 / 10</div>
      <div id="ja-text">æ—¥æœ¬èª</div>
      <input type="text" id="en-input" placeholder="è‹±èªã‚’å…¥åŠ› (Enterã§åˆ¤å®š)" autocomplete="off" spellcheck="false">
      <div id="feedback"></div>
      <button id="next-btn" class="btn-primary hidden">æ¬¡ã¸</button>
      <button class="btn-secondary back-to-menu-btn btn-interrupt">ä¸­æ–­ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>

    <div id="result-screen" class="hidden">
      <h2>ğŸ‰ ãƒ†ã‚¹ãƒˆçµ‚äº†ï¼</h2>
      <p class="result-score-text">æ­£è§£æ•°: <span id="score">0</span> / <span id="total-questions">0</span></p>
      
      <div id="mistake-log-container" class="hidden">
        <p class="mistake-log-title">ä»Šå›é–“é•ãˆãŸå˜èª:</p>
        <div id="mistake-log" class="scroll-box"></div>
      </div>
      <button class="btn-primary back-to-menu-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>
  </div>

  <script src="words.js"></script>

  <script>
    // å¤‰æ•°è¨­å®š
    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let currentMistakes = []; 
    let savedMistakes = JSON.parse(localStorage.getItem("mistakeWords")) || []; 

    // DOMè¦ç´ ã®å–å¾—
    const menuScreen = document.getElementById('menu-screen');
    const playScreen = document.getElementById('play-screen');
    const resultScreen = document.getElementById('result-screen');
    const wordListScreen = document.getElementById('word-list-screen');
    
    const startAllBtn = document.getElementById('start-all-btn');
    const startMistakeBtn = document.getElementById('start-mistake-btn');
    const clearMistakeBtn = document.getElementById('clear-mistake-btn');
    const viewListBtn = document.getElementById('view-list-btn');
    const nextBtn = document.getElementById('next-btn');
    
    const enInput = document.getElementById('en-input');
    const jaText = document.getElementById('ja-text');
    const progressText = document.getElementById('progress');
    const feedbackText = document.getElementById('feedback');
    const mistakeCountSpan = document.getElementById('mistake-count');
    
    const backButtons = document.querySelectorAll('.back-to-menu-btn');

    // åˆæœŸåŒ–å‡¦ç†
    function initMenu() {
      if (typeof allWords !== 'undefined') {
        document.getElementById('total-word-count').innerText = allWords.length;
      } else {
        document.getElementById('total-word-count').innerText = "ã‚¨ãƒ©ãƒ¼: words.jsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
      }
      
      updateMistakeUI();
      
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.5s ease-out', 10);

      menuScreen.classList.remove('hidden');
      playScreen.classList.add('hidden');
      resultScreen.classList.add('hidden');
      wordListScreen.classList.add('hidden');
    }

    function updateMistakeUI() {
      mistakeCountSpan.innerText = savedMistakes.length;
      if (savedMistakes.length > 0) {
        startMistakeBtn.disabled = false;
        clearMistakeBtn.classList.remove('hidden');
      } else {
        startMistakeBtn.disabled = true;
        clearMistakeBtn.classList.add('hidden');
      }
    }

    // å˜èªä¸€è¦§
    function showWordList() {
      const tbody = document.getElementById('word-list-tbody');
      tbody.innerHTML = '';
      
      if (typeof allWords !== 'undefined') {
        allWords.forEach((word, index) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${word.en}</td>
            <td>${word.ja}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      menuScreen.classList.add('hidden');
      wordListScreen.classList.remove('hidden');
    }

    // ã‚²ãƒ¼ãƒ é€²è¡Œ
    function startGame(mode) {
      if (mode === 'all') {
        currentQuestions = [...allWords];
      } else if (mode === 'mistake') {
        currentQuestions = [...savedMistakes];
      }
      
      currentQuestions.sort(() => Math.random() - 0.5);

      currentIndex = 0;
      score = 0;
      currentMistakes = [];
      
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.4s ease-out', 10);

      menuScreen.classList.add('hidden');
      playScreen.classList.remove('hidden');
      
      showQuestion();
    }

    function showQuestion() {
      feedbackText.innerText = "";
      feedbackText.className = "";
      enInput.value = "";
      enInput.disabled = false;
      nextBtn.classList.add('hidden');
      
      progressText.innerText = `å•é¡Œ ${currentIndex + 1} / ${currentQuestions.length}`;
      jaText.innerText = currentQuestions[currentIndex].ja;
      
      setTimeout(() => enInput.focus(), 50);
    }

    // åˆ¤å®šå‡¦ç†
    function checkAnswer() {
      const userAnswer = enInput.value.trim().toLowerCase();
      const correctAnswer = currentQuestions[currentIndex].en.toLowerCase();
      
      enInput.disabled = true;
      
      if (userAnswer === correctAnswer) {
        feedbackText.innerHTML = "â­• æ­£è§£ï¼";
        feedbackText.className = "correct";
        score++;
        
        savedMistakes = savedMistakes.filter(w => w.en !== currentQuestions[currentIndex].en);
        localStorage.setItem("mistakeWords", JSON.stringify(savedMistakes));
        
        setTimeout(nextQuestion, 600);
      } else {
        feedbackText.innerHTML = `âŒ é•ã†ã‚ˆï¼<br>æ­£è§£ã¯ï¼š <strong class="correct-word">${currentQuestions[currentIndex].en}</strong>`;
        feedbackText.className = "incorrect";
        
        const isAlreadyMistaken = savedMistakes.some(w => w.en === currentQuestions[currentIndex].en);
        if (!isAlreadyMistaken) {
          savedMistakes.push(currentQuestions[currentIndex]);
          localStorage.setItem("mistakeWords", JSON.stringify(savedMistakes));
        }
        currentMistakes.push(currentQuestions[currentIndex]);
        
        nextBtn.classList.remove('hidden');
        nextBtn.focus();
      }
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex < currentQuestions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      document.getElementById('app-container').style.animation = 'none';
      setTimeout(() => document.getElementById('app-container').style.animation = 'fadeIn 0.5s ease-out', 10);

      playScreen.classList.add('hidden');
      resultScreen.classList.remove('hidden');
      
      document.getElementById('score').innerText = score;
      document.getElementById('total-questions').innerText = currentQuestions.length;
      
      const mistakeLogContainer = document.getElementById('mistake-log-container');
      const mistakeLog = document.getElementById('mistake-log');
      
      if (currentMistakes.length > 0) {
        mistakeLogContainer.classList.remove('hidden');
        mistakeLog.innerHTML = currentMistakes.map(w => `${w.ja} <br>â†’ <strong class="mistake-word">${w.en}</strong>`).join('<hr class="mistake-separator">');
      } else {
        mistakeLogContainer.classList.add('hidden');
      }
    }

    startAllBtn.addEventListener('click', () => startGame('all'));
    startMistakeBtn.addEventListener('click', () => startGame('mistake'));
    viewListBtn.addEventListener('click', showWordList);
    nextBtn.addEventListener('click', nextQuestion);
    
    backButtons.forEach(btn => {
      btn.addEventListener('click', initMenu);
    });
    
    clearMistakeBtn.addEventListener('click', () => {
      if(confirm('é–“é•ã„ãƒªã‚¹ãƒˆã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã„ã„ï¼Ÿ')) {
        savedMistakes = [];
        localStorage.removeItem("mistakeWords");
        updateMistakeUI();
      }
    });

    enInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        if(enInput.value.trim() !== "") {
          checkAnswer();
        }
      }
    });

    window.onload = () => {
      initMenu();
    };
  </script>
</body>
</html>